language: python

python:
  - "3.5"

sudo: required
group: deprecated-2017Q4

services:
  - docker

env:
  - DOCKER_COMPOSE_VERSION=1.14.0

before_install:
  - sudo rm /usr/local/bin/docker-compose
  - curl -L https://github.com/docker/compose/releases/download/${DOCKER_COMPOSE_VERSION}/docker-compose-`uname -s`-`uname -m` > docker-compose
  - chmod +x docker-compose
  - sudo mv docker-compose /usr/local/bin

install:
  - pip install -r requirements.txt

before_script:
  - docker-compose up -d

script:
  - pycodestyle --first ttn
  - pycodestyle --first utils
  - pytest utils
  - pytest test_ttnmqtt.py
  - pytest test_discovery.py
  - pytest test_handler.py
  - pytest test_application.py

before_deploy:
  - python setup.py sdist
  - python setup.py bdist_wheel --universal

deploy:
  provider: pypi
  user: "emmlejeail"
  password:
      secure: btPNtswCa1ZWKlHVxfEspps+BehKXsz1xdpkW8VWNcaNjfo8dmEzbe3aBw7y/W5m27Sz/IvX6mpYxSfCCkgbq5pwXVE9qkB+IU3w59abXnAGID38YHldTcMoWhhnD67vmdYZHjyM0Q6QIr79+bJxG3jGCDABKd/aafBTLI/VfBDRdMXLwBL2k8b64WcnRStIb6m/4aEL0wk8MDTQF+46jG53UVJKkXRCaEQZnZeSTGrUcdxoor0ZW/h9if0nhTwDNmm07YzqblcvVyfiq0Fmup2sgP0+kZpFr5wpyI8HDuOa0VcM3WnZupCJY8c3J/HD1uy8Sn6el6nWxjWRlHzZFuI4z6U19nmVZY/0cu0Ns3dyJUv3bN0+9Du0NzSEm6sCfEXqaKa6yQLEmqDtGyLOs4odENYOlJ+SEp333is+FXidn03VLXCnxR9wu7ik928KponMlawV/40sRx+Dj5ZdT6eYJrHGiCf3aU60Zr4KvF+vI//qlk+SuN/BfHSOM6654K4aXYNxxcKfdFb5TzN15W75MRAPe40D+59ohnw6+1Y9w+ulaogwej1rAMhQukeGB5OY/J1mjkTbEkYMZE7TKbKP/YDQvW0MRvS+BchH931Tv2QmkF4schxliVYl8ynnORkkeA666MNyrfJhTPe6jHuDyhKRvEoD1O2UFQf1I7o=
  branch: master
  tags: true
